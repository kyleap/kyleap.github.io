<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Kyle Studio</title>
<meta name=keywords content=".NET,C#,Agile,DevOps,Chatbot">
<meta name=description content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<meta name=author content="Kyle">
<link rel=canonical href=https://kyleap.github.io/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<link rel=icon href=https://kyleap.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://kyleap.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://kyleap.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://kyleap.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://kyleap.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<link rel=alternate type=application/rss+xml href=https://kyleap.github.io/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)}(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-123-45','auto'),ga('send','pageview'))</script><meta property="og:title" content="Kyle Studio">
<meta property="og:description" content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kyleap.github.io/"><meta property="og:site_name" content="Kyle Studio">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Kyle Studio">
<meta name=twitter:description content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"Organization","name":"Kyle Studio","url":"https://kyleap.github.io/","description":"Kyle Studio | Share your knowledge. It’s a way to achieve immortality.","thumbnailUrl":"https://kyleap.github.io/favicon.ico","sameAs":["https://github.com/"]}</script>
</head>
<body class="list dark" id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://kyleap.github.io/ accesskey=h title="Kyle Studio (Alt + H)">Kyle Studio</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://kyleap.github.io/kyleshen/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-entry>
<header class=entry-header>
<h2>回傳不文謅謅的 Line 貼圖 (5)
</h2>
</header>
<section class=entry-content>
<p>我想 Line 豐富的貼圖，應該是很多人喜歡用它來做 Chatbot 的一個原因吧 接續上一篇，我們試著在歡迎詞後，傳送一個禮貌又不尷尬的貼圖
在 LineReplyMessageUtility.cs 擴充回傳貼圖 我們接續前一篇 LineReplyMessageUtility 這個類別再實作一個回覆貼圖的method
public async Task ReplyStickerMessageAsync(string replyToken, string packageId, string stickerId) { using(var httpClient = new HttpClient()) { using(var request = new HttpRequestMessage(new HttpMethod("POST"), $ "{lineMessageApiBaseUrl}")) { request.Headers.TryAddWithoutValidation("Authorization", $ "Bearer {accessToken}"); LineMessageReq req = new LineMessageReq(); req.ReplyToken = replyToken; req.Messages.Add(new StickerMessage() { PackageId = packageId, StickerId = stickerId }); var postJson = JsonConvert.SerializeObject(req, new JsonSerializerSettings { ContractResolver = new DefaultContractResolver { NamingStrategy = new CamelCaseNamingStrategy() }, Formatting = Formatting....</p>
</section>
<footer class=entry-footer>2020-09-19&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 回傳不文謅謅的 Line 貼圖 (5)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-5/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>回覆第一個Line的訊息-歡迎詞 (4)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day4)
本篇開始我們要來逐步實踐我們的婚禮 Chatbot 了！
我們預期在加入好友的時候 (OnFollow) 事件時回傳歡迎詞：Hi UserName, 感謝您加入 Kyle 的婚禮小助理！
取得使用者的資訊 記得上一篇講 Webhook Event 時的結構嗎? 裡面有個 userId
查看文件後，可以透過 access token 和 userId 來取得用戶資訊
建立一個 LineProfileUtility.cs 取得使用者資訊 我們建立一個 Class 來實作取得使用者相關程式，讓未來不同的情境可以調用，以下是文件取得使用者範例的Sample
curl -v -X GET https://api.line.me/v2/bot/profile/{userId} \ -H 'Authorization: Bearer {channel access token}' 有個小技巧可以把 curl 轉成 C# 的 HttpClinet ，將以上的資訊貼到 https://curl.olsh.me/ 即可轉換完成，再做一些微調就好了
轉換後如下：
using (var httpClient = new HttpClient()) { using (var request = new HttpRequestMessage(new HttpMethod("GET"), "[https://api....</p>
</section>
<footer class=entry-footer>2020-09-18&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 回覆第一個Line的訊息-歡迎詞 (4)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-4/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>用.NET Core 接收Line的訊息事件 (3)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day3)
先來看看文件 在 Line 的文件裡有定義 Webhook Event Objects 傳過來的 JSON 的結構
可以看到它會傳一個 events 過來，裡面包含幾個 properties
replyToken : 用來回覆該使用者的Token type：使用者傳送訊息的類型 (message/video/sticker…) mode: Channel是否有效 source:使用者/群組的資訊 … 以上都可以從上方的文件去查看 properties 的用途
將 Line Event Request 轉成 C# Class 在上一篇我們 Web Api 是用 dynamic 來接收 Request，在VS有個功能是很快的把 JSON 結構轉成 C# 的 Class，這個技巧在串接異質 Api 蠻常用的，或者是可以用 json2csharp.com 這種服務來處理。
複製官方的JSON Sample，在 VS 點選編輯 => 選擇性貼上 => 貼上 JSON
結果會長這樣，通常我不會在一個 .cs 放多個類別，但為了文章好呈現故直接貼上來，拆一拆檔案的工也還好
做點加工，把 Event 的 Type 一些文件改成 C# 的 Enum，讓開發更順暢，新增一個 WebhookEventType....</p>
</section>
<footer class=entry-footer>2020-09-17&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 用.NET Core 接收Line的訊息事件 (3)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-3/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>用.NET Core接收第一個Line訊息 (2)
</h2>
</header>
<section class=entry-content>
<p>基本設定 關於如何註冊一個串接自己Web Api 的 Line Chatbot 網路上已經很多的教學文了，大概分為以下幾個步驟
https://developers.line.biz/en/
申請一個Provider 申請一個Channel (一個Provider可以有多個Channel) 於Channel取得 Channel Secret 及 Access Token Use webhook 啟用 Auto-reply messages 關閉 設定 Webhook URL (需為https) 起始 Web API 專案與 Line Server 做連結 建立一個 .NET Core 3.1 的 Web Api 專案
建立一個 Line Controller，先用 dynamic 接收，看看 Request 過來的是什麼
執行看看，weatherforecast 為初始專案的 Sample，此Local Api 的 Port 為 44300
透過 ngrok 讓 Line Server 跟 Local Web API 做連結
安裝 node....</p>
</section>
<footer class=entry-footer>2020-09-16&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 用.NET Core接收第一個Line訊息 (2)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-2/></a>
</article>
<article class=post-entry>
<header class=entry-header>
<h2>用.NET Core與Line Bot製作婚禮機器人 (1)
</h2>
</header>
<section class=entry-content>
<p>寫在開始之前，目的與動機 距離上次參加鐵人賽已經是 2013-2014 的事，很慶幸自己還是活在這行且保有一些技術的熱情還沒死掉。2018 年完成了人生的婚禮，因為個性屬於比較喜歡搞一些特別的，把自己的想法用技術實踐，所以從做影片到還製作婚禮活動官網到婚禮現場都規劃一些比較不一樣的體驗，身為一個技術宅寫一些程式是必須的，所以那時候做了一個當時很流行的 Line Chatbot，整個婚禮報名流程/推播訊息都是透過Line Chatbot完成，幾個朋友回饋都覺得比起一些問卷網站，這種方式還蠻新奇的，後續一些辦婚禮的朋友都還來詢問當時 Line 的一些功能是怎麼用的，也想透過這種方式來玩。2年也過去了，Line 的 Chatbot 也改版了不少，故這次想要藉由鐵人賽，再逐步的好好再把 Line 的文件看過一遍，並重新開發，透過這過程也分享一些當時的一些尚未做的想法實踐
先來聊聊一個基本的 Line 對話的流程大概會遇到什麼事情
使用者發送訊息，向 Line Server 發送一個 Request Line Server 會知道是哪個 Chatbot 發送的，經過格式處理後會發送到該Chatbot作者所設定的 Webhook Webhook (自己所開發的Web Api)，能接收到 Line Server 所傳的結構化Request，能知道使用者發送了什麼訊息，應該要做什麼相對應的處理 回傳相對應處理的訊息，告訴 Line Server，我們要回覆什麼 透過 Line Server 再回傳給使用者 目標 在這個 Line Chatbot 我們將實作婚禮前的資訊查詢，快速建立各種能理解聊天意圖的回覆，宴客報名… 等等，透過這些功能的實作，我們將會學到，如何用 Line 來傳各式各樣的豐富訊息，學到如何開發一個網頁來搭配 Line Liff 來做一些小程序，在婚禮會現場會嘗試用 QR Code/iBeacon 搭配婚禮的報到，嘗試用 Line Pay 來做紅包的電子支付，婚禮現場做一些互動的功能…
所用到的技術預計採用 .NET Core 3.1、Html/CSS/JavaScript、Line API 、Azure的一些服務…等等 (但寫這篇文章時完全還沒實作XD…只能說待訂)
也發現在 Line 官方都沒有 ....</p>
</section>
<footer class=entry-footer>2020-09-15&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 用.NET Core與Line Bot製作婚禮機器人 (1)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-1/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=prev href=https://kyleap.github.io/page/7/>« Prev Page</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://kyleap.github.io/>Kyle Studio</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>