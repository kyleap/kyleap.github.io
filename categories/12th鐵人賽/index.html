<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>12th鐵人賽 | Kyle Studio</title>
<meta name=keywords content>
<meta name=description content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<meta name=author content="Kyle">
<link rel=canonical href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style>
<link rel=icon href=https://kyleap.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://kyleap.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://kyleap.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://kyleap.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://kyleap.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<link rel=alternate type=application/rss+xml href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DPE6YM5E5N"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DPE6YM5E5N',{anonymize_ip:!1})}</script>
<meta property="og:title" content="12th鐵人賽">
<meta property="og:description" content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/"><meta property="og:site_name" content="Kyle Studio">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="12th鐵人賽">
<meta name=twitter:description content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
</head>
<body class="list dark" id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://kyleap.github.io/ accesskey=h title="凱哥打扣 (Alt + H)">凱哥打扣</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://kyleap.github.io/kyleshen/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<header class=page-header><div class=breadcrumbs><a href=https://kyleap.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://kyleap.github.io/categories/>Categories</a></div>
<h1>
12th鐵人賽
</h1>
</header>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>鐵人賽完賽整理&開源 (30)
</h2>
</header>
<div class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day30)
終於走到這一天了，每次都覺得鐵人賽過程都生不如死，但寫完30天候總有一種成就感，技術跟文章不難，難的是30天養成一個固定的習慣阿!
回到第一天文章所講的：所用到的技術預計採用 .NET Core 3.1、Html/CSS/JavaScript、Line API 、Azure的一些服務…等等 (但寫這篇文章時完全還沒實作XD…只能說待訂)
這次寫完30天也收穫良多，主要也是挑一些之前比較少碰的東西順便玩玩看
把 Line 的 Api 文件又完整K了一遍，並一個一個寫成 .NET Core 的版本， 之前比較沒碰過的是 Line Pay/Line Beacon 寫得過程中看到 vue 海賊王版本推出 (vue 3.0)，起了專案實踐了一些功能，來看看它的架構 用了 Razor Page，讓我回到 ASP.NET WebForm 的復古感 玩了一些 Azure 服務，Azure Storage、QnA Maker，其中 Azure SignalR Service 是之前比較沒玩過的 把之前自己婚禮用的 chatbot 改一版，順便要給接下來結婚的朋友用 XD 真實的把所做的Side Project給用上 邊看文件邊寫SDK出來，並開源出來 本篇就來講講最後一哩路，怎麼發佈到 NuGet 上吧！
我將這次系列邊走邊看得的程式稍作整理，建立一個 .NET Core 的函示庫專案
在 VS 按右鍵套件
或者可以使用CLI : dotnet pack
編輯套件的資訊...</p>
</div>
<footer class=entry-footer><span title="2020-11-30 00:11:40 +0000 UTC">2020-11-30</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 鐵人賽完賽整理&開源 (30)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-30/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>製作婚禮現場即時留言版- Azure SignalR Service II (29)
</h2>
</header>
<div class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day29)
在上一篇我們用 Console App 發送訊息到 Api 的 Server Hub，並呈現在HTML上，今天這篇我們要來結合 chatbot，其實就是在chatbot當成SignalR的client而已，實際效果如下(本篇不會介紹CSS部分)：
新增一個 MessageBoard class 來處理留言板發送，這部分可以看這篇
而透過 Line 的 User Id ，我們能取得使用者的大頭照.姓名…等等資訊
public async Task ReplyAsync(string replyToken) { var profile = await lineProfileUtility.GetUserProfile(userId); var hubClient = new ClientSignalR(); await hubClient.Initialize("http://localhost:12733/message"); await hubClient.SendHubMessage("SendMessage", profile.pictureUrl, profile.displayName, message); await lineMessageUtility.ReplyMessageAsync(replyToken, "謝謝您，我們已收到留言"); } GetUserProfile
public async Task&lt;UserProfile> GetUserProfile(string userId) { using (var httpClient = new HttpClient()) { using (var request = new HttpRequestMessage(new HttpMethod("GET"), $"{lineMessageApiBaseUrl}/{userId}")) { request....</p>
</div>
<footer class=entry-footer><span title="2020-11-29 12:23:59 +0000 UTC">2020-11-29</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 製作婚禮現場即時留言版- Azure SignalR Service II (29)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-29/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>製作婚禮現場即時留言版- Azure SignalR Service I (28)
</h2>
</header>
<div class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day28)
SignalR是實現即時通訊的框架，如下圖，在Server Hub宣告要給client端呼叫的方法，能傳送即時訊息給已連線的使用者
https://www.pubnub.com/learn/glossary/what-is-signalr/
而透過Azure SignalR 服務，大大簡化使用門檻，很簡單就能建立一個服務，且享有雲端帶來的高拓展性，這篇文章會step by step 實作以下內容
建立 Azure SignalR 服務 建立 SignalR Server Hub 建立 HTML Client 即時呈現訊息 建立 .NET Console App 來發送訊息 建立 Azure SignalR 服務 登入Azure，進入https://portal.azure.com/#create/Microsoft.SignalRGalleryPackage 新增服務
建完後，到key的選單，我們等等需要這個 Connection String
建立 SignalR Server Hub 打開 Web Api 專案的 .csproj，加入以下程式碼
&lt;ItemGroup> &lt;DotNetCliToolReference Include="Microsoft.VisualStudio.Web.CodeGeneration.Tools" Version="2.0.0" /> &lt;DotNetCliToolReference Include="Microsoft.Extensions.SecretManager.Tools" Version="2.0.0" /> &lt;/ItemGroup> 用 Nuget 安裝 Microsoft.Azure.SignalR
在 Web Api 專案案右鍵，建立管理使用者密碼，
建立 Azure:SignalR:ConnectionString ，把剛剛的連線字串貼上...</p>
</div>
<footer class=entry-footer><span title="2020-11-28 13:28:25 +0000 UTC">2020-11-28</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 製作婚禮現場即時留言版- Azure SignalR Service I (28)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-28/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>收集婚禮現場照片- 將圖片用C#傳到 Imgur 服務 (27)
</h2>
</header>
<div class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day27)
婚禮現場一定會有各種親朋好友視角的照片，以往都要一個一個傳在社群媒體之類的，本次來實作 chatbot 來廣收各種朋友拍的照片.. XD
上傳到 Imgur Imgur是個圖床服務，如果是非商業使用，是完全免費的，串接起來也很容易，首先先到 https://api.imgur.com/oauth2/addclient 註冊一個 OAuth 服務
會得到 client id 和 client secret
回到 LineBotApp.cs，我們可以針對圖片類型的訊息做處理
GetContentBytesAsync
public async Task&lt;Stream> GetContentBytesAsync(string messageId) { using (var httpClient = new HttpClient()) { using (var request = new HttpRequestMessage(new HttpMethod("GET"), $"https://api-data.line.me/v2/bot/message/{messageId}/content")) { request.Headers.TryAddWithoutValidation("Authorization", $"Bearer {accessToken}"); var response = await httpClient.SendAsync(request); var results = await response.Content.ReadAsStreamAsync(); return results; } } } UploadToImgurAsync
可以透過 Nuget 安裝 Imgur.API
public async Task&lt;string> UploadToImgurAsync(Stream stream) { var apiClient = new ApiClient("&lt;Your Imgur ClientId>"); var httpClient = new HttpClient(); var imageEndpoint = new ImageEndpoint(apiClient, httpClient); var imageUpload = await imageEndpoint....</p>
</div>
<footer class=entry-footer><span title="2020-11-27 00:32:07 +0000 UTC">2020-11-27</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 收集婚禮現場照片- 將圖片用C#傳到 Imgur 服務 (27)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-27/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>婚禮禮金用Line Pay II (26)
</h2>
</header>
<div class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day26)
以下是 Line 官方文件的流程，今天會依據這個圖的流程來實作 Line Pay 付款
https://pay.line.me/jp/developers/apis/onlineApis?locale=zh_TW
Checkout 流程 官方API文件可以從這裡看到
Request Body 的 C# Class
public class LinePayRequest { public int amount { get; set; } public string currency { get; set; } public string orderId { get; set; } public List&lt;Package> packages { get; set; } public Options options { get; set; } public Redirecturls redirectUrls { get; set; } } public class Package { public string id { get; set; } public int amount { get; set; } public string name { get; set; } public List&lt;Product> products { get; set; } } public class Product { public string id { get; set; } public string name { get; set; } public string imageUrl { get; set; } public int quantity { get; set; } public int price { get; set; } } public class Options { public Payment payment { get; set; } } public class Payment { public bool capture { get; set; } } public class Redirecturls { public string confirmUrl { get; set; } public string cancelUrl { get; set; } } 整個 Post 的 Body 可以這樣組成，channelId和channelSecret可以在前一篇申請sandbox時候取得...</p>
</div>
<footer class=entry-footer><span title="2020-11-26 00:06:44 +0000 UTC">2020-11-26</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 婚禮禮金用Line Pay II (26)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-26/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=next href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/2/>Next&nbsp;&nbsp;»
</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://kyleap.github.io/>Kyle Studio</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>