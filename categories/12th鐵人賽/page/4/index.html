<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>12th鐵人賽 | Kyle Studio</title>
<meta name=keywords content>
<meta name=description content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<meta name=author content="Kyle">
<link rel=canonical href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.min.5e2b4101351c21e906f398ae96901791830f58d430f96f2659dab7eaef7b3cb7.css integrity="sha256-XitBATUcIekG85iulpAXkYMPWNQw+W8mWdq36u97PLc=" rel="preload stylesheet" as=style>
<link rel=icon href=https://kyleap.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://kyleap.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://kyleap.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://kyleap.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://kyleap.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.88.1">
<link rel=alternate type=application/rss+xml href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/index.xml>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DPE6YM5E5N"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DPE6YM5E5N',{anonymize_ip:!1})}</script>
<meta property="og:title" content="12th鐵人賽">
<meta property="og:description" content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/"><meta property="og:site_name" content="Kyle Studio">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="12th鐵人賽">
<meta name=twitter:description content="Kyle Studio | Share your knowledge. It’s a way to achieve immortality.">
</head>
<body class="list dark" id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://kyleap.github.io/ accesskey=h title="Kyle Studio (Alt + H)">Kyle Studio</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://kyleap.github.io/kyleshen/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<header class=page-header><div class=breadcrumbs><a href=https://kyleap.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://kyleap.github.io/categories/>Categories</a></div>
<h1>12th鐵人賽</h1>
</header>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>切換 Line 的圖文選單 (15)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day15)
在上一篇我們介紹如何設定圖文選單，本篇要來介紹如何切換圖文選單，此部分只能用程式來達成，在 Line Business 後台只能設定固定的圖文選單起訖日，有了這功能就可以像網站一樣有網站地圖的概念
今天實作要將 chatbot 隨機切換不同的圖文選單，給使用者不同的體驗，今天的範例圖片在這 https://i.imgur.com/pupYvXr.jpg
CreateRichMenuAsync
原本預設的 Rich Menu 是寫在 SetDefaultRichMenuAsync，我們做點重構，讓Rich Menu 的物件是從外部傳入，因為我們現在要設定多個選單
public async Task&lt;Richmenu> CreateRichMenuAsync(CreateRichmenu richmenu) { using (var httpClient = new HttpClient()) { using (var request = new HttpRequestMessage(new HttpMethod("POST"), lineMessageApiBaseUrl)) { request.Headers.TryAddWithoutValidation("Authorization", $"Bearer {accessToken}"); var postJson = JsonConvert.SerializeObject(richmenu, new JsonSerializerSettings { NullValueHandling = NullValueHandling.Ignore, ContractResolver = new DefaultContractResolver { NamingStrategy = new CamelCaseNamingStrategy() } }); request.Content = new StringContent(postJson); request....</p>
</section>
<footer class=entry-footer>2020-11-15&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 切換 Line 的圖文選單 (15)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-15/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Line 的圖文選單 (14)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day14)
在 Line 的官方帳號可以設定進入時的選單，讓使用者快速點選，設定方式可以從官方帳號後台(有既定的範本可以參考)，或者是用程式自己指定(可以自己控制圖片的座標&設定點選區塊)，以下分別介紹
從官方帳號後台 這應該是最方便的方式了，Line 已經提供了一些範本和設計規範，只要照著範本製作一個圖片，並設定每個區塊要觸發的事件，即可完成一個圖文選單
進入 https://manager.line.biz/ 選擇圖文選單 => 建立 => 設計規範 => 下載範本，(或者直接點此下載)，下載後會是一個壓縮檔，今天來用這個範例做修改
我們用 PhotoShop 改成我們要的圖片 (這就不介紹啦) https://imgur.com/ev4LQzp.jpg
上傳圖片，並設定 A.B.C 所要觸發的文字
這樣就完成了，是不是很方便阿
從程式指定 Rich Menu 程式就沒有用 Business 後台直接上傳圖片來得那麼方便，但程式可以做到極彈性，它可以自訂圖片的座標來設定 click 的範圍，可以針對使用者來動態的切換 Rich Menu 等等…。Rich Menu 所牽扯的 Api 有點多，故先整理今天會實作的 Api 清單如下
Get rich menu list：取得此 chatbot 已註冊的 Rich Menu 清單 Upload rich menu image：設定 Rich Menu 的圖片 Set default rich menu：設定所檢視的 Rich Menu
新增 LineRichMenuUtility.cs 之前 Message API 我們做了 一個 Utility ，Rich Menu 我們也新增一個...</p>
</section>
<footer class=entry-footer>2020-11-14&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to Line 的圖文選單 (14)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-14/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>各種訊息都玩過了，來聊聊使用者體驗 (Quick Reply) (13)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day13)
Chatbot 有分為兩種類型，一個是任務型導向，另一個是聊天型導向，聊天型導向最典型的就是 Siri，講什麼他都會回答你，這背後所支撐的是海量數據訓練出來的，在我們設計應用 Chatbot 時，多半會偏向任務型導向，使用者用你的 Chatbot 不是要跟你聊天，是要快速的用你這服務達到任務，所以在設計時，如果定位 Chatbot 是 “人” ，是非常可怕的設計，只會降低使用者的觀感。
在設計 Line Chatbot 時，如果使用者在對話過程中迷路了，不妨設計一些快捷鍵引導到他的目標吧，這個在 Line 裡面實作叫 Quick Reply，我們今天將做在無法辨識使用者的意圖時，回傳一些引導的快捷鍵
IntenFactory.cs
之前有設定一個 DefaultIntent.cs 我們將修改這個實作
當聽不懂的時候 回傳三個快捷鍵
public async Task ReplyAsync(string replyToken) { if (!string.IsNullOrEmpty(replyText)) { await lineMessageUtility.ReplyMessageAsync(replyToken, replyText); } else { // 回傳歡迎詞 var unknow = new TextMessage() { Text = $@"不好意思，我不太清楚您的意思，或許你可以用下列快速鍵 (僅支援手機)" }; // Quick Reply unknow.QuickReply = new QuickReply(); unknow.QuickReply.Items.Add(new QuickReplyItem() { action = new MessageAction("電子喜帖"), }); unknow....</p>
</section>
<footer class=entry-footer>2020-11-13&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 各種訊息都玩過了，來聊聊使用者體驗 (Quick Reply) (13)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-13/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>Hold on Hold on 重構一下！ (12)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day12)
這篇要來緩一下，做第一次的重構，寫到現在會發現 LineBotApp.cs 這個 class開始複雜了，程式碼越來越長，在OnMessageAsync.OnPostbackAsync 開始有相同的 Intent 重複定義
我們把取得 Intent 封裝成一個工廠
IIntentFactory.cs 定義一個工廠介面
public interface IIntentFactory { IReplyIntent GetIntent(string intentName, string userId); } IntentFactory.cs 實作這個介面
public class IntentFactory : IIntentFactory { private readonly LineReplyMessageUtility lineMessageUtility; private readonly LineProfileUtility lineProfileUtility; public IntentFactory(LineReplyMessageUtility _lineMessageUtility, LineProfileUtility _lineProfileUtility) { lineMessageUtility = _lineMessageUtility; lineProfileUtility = _lineProfileUtility; } public IReplyIntent GetIntent(string intentName, string userId) { var intents = new Dictionary&lt;string, IReplyIntent>() { { "Welcome" , new Welcome(lineMessageUtility,lineProfileUtility,userId)}, { "電子喜帖" , new WeddingInvitationFromImage(lineMessageUtility,lineProfileUtility)}, { "電子喜帖(FlexMsg)" , new WeddingInvitation(lineMessageUtility,lineProfileUtility)}, { "前導影片" , new WeddingTrailer(lineMessageUtility,lineProfileUtility)}, { "婚宴地點" , new WeddingLocation(lineMessageUtility,lineProfileUtility)}, { "婚紗輪播" , new PhotoCarousel(lineMessageUtility,lineProfileUtility)}, { "交通資訊" , new Directions(lineMessageUtility,lineProfileUtility)}, { "從高鐵" , new DefaultIntent(lineMessageUtility,lineProfileUtility,"至 北門站 搭乘松山新店線至 南京復興站 步行7分鐘")}, { "從捷運" , new DefaultIntent(lineMessageUtility,lineProfileUtility,"捷運台北小巨蛋站6分鐘/南京復興站只需7分鐘")}, { "從機場" , new DefaultIntent(lineMessageUtility,lineProfileUtility,"酒店距離松山國際機場僅 5 分鐘車程")}, { "停車資訊" , new DefaultIntent(lineMessageUtility,lineProfileUtility,"酒店的停車場為室內停車場，位於B5及B6")}, { "開車提醒" , new DefaultIntent(lineMessageUtility,lineProfileUtility,"?...</p>
</section>
<footer class=entry-footer>2020-11-12&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to Hold on Hold on 重構一下！ (12)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-12/></a>
</article>
<article class="post-entry tag-entry">
<header class=entry-header>
<h2>設計師魂發作，改造電子喜帖 (11)
</h2>
</header>
<section class=entry-content>
<p>第12 屆iT邦幫忙鐵人賽系列文章 (Day11)
如果前面介紹的訊息類型都不夠怎麼辦？就用 Flex Message 做個客製化的訊息吧，看看官網這些 showcase，4不4很酷阿
設計魂發作 這些效果，主要都是用 JSON 字串組出來的，官網也很貼心的提供 Simulator 來讓你用GUI的方式來設定自己客製的 Flex Message，之前電子喜帖是用圖片的方式，我們來改成 Flex Message 吧。
我在 Simulator 拉的訊息圖片如下 (其實蠻好上手的)
加入行事曆希望引導到 Google Map
透過 UriAction 即可解決
https://calendar.google.com/calendar/u/0/r/eventedit?text=Kyle%27s%20Wedding&dates=20201208T100000Z/20201208T140000Z&details&location=%E5%8F%B0%E5%8C%97%E6%9D%B1%E6%96%B9%E6%96%87%E8%8F%AF
點選右上角 View as JSON 就能取得完整的 JSON 字串
回到 .NET 發送吧，在 LineReplyMessageUtility.cs 實作 ReplyMessageByJsonAsync
public async Task ReplyMessageByJsonAsync(string replyToken, string jsonString) { using (var httpClient = new HttpClient()) { using (var request = new HttpRequestMessage(new HttpMethod("POST"), $"{lineMessageApiBaseUrl}")) { request.Headers.TryAddWithoutValidation("Authorization", $"Bearer {accessToken}"); LineMessageReq req = new LineMessageReq(); req....</p>
</section>
<footer class=entry-footer>2020-11-11&nbsp;·&nbsp;1 min&nbsp;·&nbsp;Kyle</footer>
<a class=entry-link aria-label="post link to 設計師魂發作，改造電子喜帖 (11)" href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-11/></a>
</article>
<footer class=page-footer>
<nav class=pagination>
<a class=prev href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/3/>« Prev Page</a>
<a class=next href=https://kyleap.github.io/categories/12th%E9%90%B5%E4%BA%BA%E8%B3%BD/page/5/>Next Page »</a>
</nav>
</footer>
</main>
<footer class=footer>
<span>&copy; 2021 <a href=https://kyleap.github.io/>Kyle Studio</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>