<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>來點AI感，用QnA Maker來搞Line Chatbot回覆 (16) | 凱哥打扣 | Kyle Studio</title>
<meta name=keywords content="Chatbot"><meta name=description content="第12 屆iT邦幫忙鐵人賽系列文章 (Day16)
QnA Maker 是啥 QnA Maker 是微軟提供一個雲端的自然語言處理 (NLP) 處理服務，可輕鬆透過網站後台建立自己的知識庫，並能從使用者所輸入的語句，理解他的意圖，提供可能對應的知識庫答案。QnA Maker提供了免費的方案，但限制就是只能有3份知識庫、每秒只能調用Api 3次，每月50,000筆Request，對於一般使用或技術評估來講很夠用了。要在 Line 串接大概分為以下步驟：
在Azure註冊 QnA Maker 新增一個 knowledge base 增加題目與回答 完成訓練 & 發佈 取得 Endpoint、EndpointKey，來讓程式串接 建立 QnA Maker 照著 https://www.qnamaker.ai/Create Step By Step 步驟，因為QnA Maker是Azure的服務，故您可以需要Azure的訂閱，由此註冊試用
Step 1 在 Azure 新增 QnA Maker 服務
Step 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文
Step 3 knowledge base 名稱
步驟四可以匯入現有的資料集，來源可以是文件或者是線上的網站，這樣就不用重新建檔了，是不是很酷啊 :D
Step 4 匯入資料集 (本次先跳過)
開始瘋狂建題目吧！我們來試試建立：&ldquo;新人怎麼認識的？&rdquo; 回答我們設定 &ldquo;我們是在打工餐廳認識的喔，那時的同事 put your hands up ??&#34;，並點選Save And Train"><meta name=author content="Kyle"><link rel=canonical href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-16/><meta name=google-site-verification content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://kyleap.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kyleap.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kyleap.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://kyleap.github.io/apple-touch-icon.png><link rel=mask-icon href=https://kyleap.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-DPE6YM5E5N"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-DPE6YM5E5N",{anonymize_ip:!1})}</script><meta property="og:title" content="來點AI感，用QnA Maker來搞Line Chatbot回覆 (16)"><meta property="og:description" content="第12 屆iT邦幫忙鐵人賽系列文章 (Day16)
QnA Maker 是啥 QnA Maker 是微軟提供一個雲端的自然語言處理 (NLP) 處理服務，可輕鬆透過網站後台建立自己的知識庫，並能從使用者所輸入的語句，理解他的意圖，提供可能對應的知識庫答案。QnA Maker提供了免費的方案，但限制就是只能有3份知識庫、每秒只能調用Api 3次，每月50,000筆Request，對於一般使用或技術評估來講很夠用了。要在 Line 串接大概分為以下步驟：
在Azure註冊 QnA Maker 新增一個 knowledge base 增加題目與回答 完成訓練 & 發佈 取得 Endpoint、EndpointKey，來讓程式串接 建立 QnA Maker 照著 https://www.qnamaker.ai/Create Step By Step 步驟，因為QnA Maker是Azure的服務，故您可以需要Azure的訂閱，由此註冊試用
Step 1 在 Azure 新增 QnA Maker 服務
Step 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文
Step 3 knowledge base 名稱
步驟四可以匯入現有的資料集，來源可以是文件或者是線上的網站，這樣就不用重新建檔了，是不是很酷啊 :D
Step 4 匯入資料集 (本次先跳過)
開始瘋狂建題目吧！我們來試試建立：&ldquo;新人怎麼認識的？&rdquo; 回答我們設定 &ldquo;我們是在打工餐廳認識的喔，那時的同事 put your hands up ??&#34;，並點選Save And Train"><meta property="og:type" content="article"><meta property="og:url" content="https://kyleap.github.io/it-ironman-line-chatbot-wedding-16/"><meta property="og:image" content="https://user-images.githubusercontent.com/8849818/227669578-aace96bd-bfb3-4cd5-9e52-52d8742ed597.jpg"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-11-16T08:17:05+00:00"><meta property="article:modified_time" content="2020-11-16T08:17:05+00:00"><meta property="og:site_name" content="凱哥打扣 | Kyle Studio"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://user-images.githubusercontent.com/8849818/227669578-aace96bd-bfb3-4cd5-9e52-52d8742ed597.jpg"><meta name=twitter:title content="來點AI感，用QnA Maker來搞Line Chatbot回覆 (16)"><meta name=twitter:description content="第12 屆iT邦幫忙鐵人賽系列文章 (Day16)
QnA Maker 是啥 QnA Maker 是微軟提供一個雲端的自然語言處理 (NLP) 處理服務，可輕鬆透過網站後台建立自己的知識庫，並能從使用者所輸入的語句，理解他的意圖，提供可能對應的知識庫答案。QnA Maker提供了免費的方案，但限制就是只能有3份知識庫、每秒只能調用Api 3次，每月50,000筆Request，對於一般使用或技術評估來講很夠用了。要在 Line 串接大概分為以下步驟：
在Azure註冊 QnA Maker 新增一個 knowledge base 增加題目與回答 完成訓練 & 發佈 取得 Endpoint、EndpointKey，來讓程式串接 建立 QnA Maker 照著 https://www.qnamaker.ai/Create Step By Step 步驟，因為QnA Maker是Azure的服務，故您可以需要Azure的訂閱，由此註冊試用
Step 1 在 Azure 新增 QnA Maker 服務
Step 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文
Step 3 knowledge base 名稱
步驟四可以匯入現有的資料集，來源可以是文件或者是線上的網站，這樣就不用重新建檔了，是不是很酷啊 :D
Step 4 匯入資料集 (本次先跳過)
開始瘋狂建題目吧！我們來試試建立：&ldquo;新人怎麼認識的？&rdquo; 回答我們設定 &ldquo;我們是在打工餐廳認識的喔，那時的同事 put your hands up ??&#34;，並點選Save And Train"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kyleap.github.io/posts/"},{"@type":"ListItem","position":2,"name":"來點AI感，用QnA Maker來搞Line Chatbot回覆 (16)","item":"https://kyleap.github.io/it-ironman-line-chatbot-wedding-16/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"來點AI感，用QnA Maker來搞Line Chatbot回覆 (16)","name":"來點AI感，用QnA Maker來搞Line Chatbot回覆 (16)","description":"第12 屆iT邦幫忙鐵人賽系列文章 (Day16)\nQnA Maker 是啥 QnA Maker 是微軟提供一個雲端的自然語言處理 (NLP) 處理服務，可輕鬆透過網站後台建立自己的知識庫，並能從使用者所輸入的語句，理解他的意圖，提供可能對應的知識庫答案。QnA Maker提供了免費的方案，但限制就是只能有3份知識庫、每秒只能調用Api 3次，每月50,000筆Request，對於一般使用或技術評估來講很夠用了。要在 Line 串接大概分為以下步驟：\n在Azure註冊 QnA Maker 新增一個 knowledge base 增加題目與回答 完成訓練 \u0026amp; 發佈 取得 Endpoint、EndpointKey，來讓程式串接 建立 QnA Maker 照著 https://www.qnamaker.ai/Create Step By Step 步驟，因為QnA Maker是Azure的服務，故您可以需要Azure的訂閱，由此註冊試用\nStep 1 在 Azure 新增 QnA Maker 服務\nStep 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文\nStep 3 knowledge base 名稱\n步驟四可以匯入現有的資料集，來源可以是文件或者是線上的網站，這樣就不用重新建檔了，是不是很酷啊 :D\nStep 4 匯入資料集 (本次先跳過)\n開始瘋狂建題目吧！我們來試試建立：\u0026ldquo;新人怎麼認識的？\u0026rdquo; 回答我們設定 \u0026ldquo;我們是在打工餐廳認識的喔，那時的同事 put your hands up ??\u0026quot;，並點選Save And Train","keywords":["Chatbot"],"articleBody":"第12 屆iT邦幫忙鐵人賽系列文章 (Day16)\nQnA Maker 是啥 QnA Maker 是微軟提供一個雲端的自然語言處理 (NLP) 處理服務，可輕鬆透過網站後台建立自己的知識庫，並能從使用者所輸入的語句，理解他的意圖，提供可能對應的知識庫答案。QnA Maker提供了免費的方案，但限制就是只能有3份知識庫、每秒只能調用Api 3次，每月50,000筆Request，對於一般使用或技術評估來講很夠用了。要在 Line 串接大概分為以下步驟：\n在Azure註冊 QnA Maker 新增一個 knowledge base 增加題目與回答 完成訓練 \u0026 發佈 取得 Endpoint、EndpointKey，來讓程式串接 建立 QnA Maker 照著 https://www.qnamaker.ai/Create Step By Step 步驟，因為QnA Maker是Azure的服務，故您可以需要Azure的訂閱，由此註冊試用\nStep 1 在 Azure 新增 QnA Maker 服務\nStep 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文\nStep 3 knowledge base 名稱\n步驟四可以匯入現有的資料集，來源可以是文件或者是線上的網站，這樣就不用重新建檔了，是不是很酷啊 :D\nStep 4 匯入資料集 (本次先跳過)\n開始瘋狂建題目吧！我們來試試建立：“新人怎麼認識的？” 回答我們設定 “我們是在打工餐廳認識的喔，那時的同事 put your hands up ??\"，並點選Save And Train\n可以透過旁邊的模擬器測試，嘗試打類似的問話，都會對應的相同的回答\n在 .NET Core 串接 QnA Maker 在串接之前，記得要先點選 Publish\n又是得到一個熟悉的 curl 指令，可以繼續用 https://curl.olsh.me/ 來轉 C# 啦\nQnAMakerUtility.cs\n新增一個 Utility 來處理 QnA Maker，裡面的 Key 應該要移到appsetting.json比較好替換，最初幾篇有提到可以用 IOption 來注入，這邊就不再多提了。QnA Maker判斷出來會有個分數值，我們篩選最高的當作答案，另也定義一個選擇新參數為分數，如果有值的話，要大於這個分數我們才會回傳。\npublic class QnAMakerUtility { public async Task Get(string question, int? scope = null) { using (var httpClient = new HttpClient()) { using (var request = new HttpRequestMessage(new HttpMethod(\"POST\"), \"https://qna-maker-lab.azurewebsites.net/qnamaker/knowledgebases/OOOOO-2d0e-4512-ba3f-a58fdc4c37e1/generateAnswer\")) { request.Headers.TryAddWithoutValidation(\"Authorization\", \"EndpointKey 5fdcf6c7-eb76-4a53-9e3b-74570645bOOO\"); request.Content = new StringContent(\"{'question':'\" + question + \"'}\"); request.Content.Headers.ContentType = MediaTypeHeaderValue.Parse(\"application/json\"); var response = await httpClient.SendAsync(request); var result = await response.Content.ReadAsStringAsync(); var qnaResponse = JsonConvert.DeserializeObject(result); // 取得分數最高的回答 var answers = qnaResponse.answers; // 選擇性參數，大於多少分數才回傳，這樣看起來會比較準 if(scope.HasValue) { answers = answers.Where(c =\u003e c.score \u003e= scope.Value); } var answer = answers.OrderByDescending(c =\u003e c.score).FirstOrDefault(); // 無法辨識 if (answer == null || answer.id == -1) return null; return answer; } } } } QnAMakerResponse\npublic class QnAMakerResponse { public IEnumerable answers { get; set; } public bool activeLearningEnabled { get; set; } } public class QnAMakterAnswer { public object[] questions { get; set; } public string answer { get; set; } public float score { get; set; } public int id { get; set; } public object[] metadata { get; set; } } 調整一下 IntenFactory.cs\n我們先判斷 Rule Base 的回覆 (字串完整比對)，有比對到就回傳了，如果沒有比對到，則丟到 AI Base (QnA Maker) 來判斷\n傳送 “新人怎麼認識的？” 分數是 100 分\n傳送 “當初怎麼交往的?” 分數是 26.53 分\n所以對話模型是要逐步訓練的，我們調整一下，提升交往關鍵字的分數，要記得重新訓練和發佈\n傳送 “交往的過程”，得到重新訓練後的分數 99 分了\n本篇就是 .NET Core 串接 QnA Maker 的過程，透過這種雲端語意辨識服務，我們再也不用在程式擴增一堆 Intent 實作，並且讓 Chatbot 聰明一點，使用者為什麼都可以知道它想問的意圖是什麼。如果要更聰明一點訓練，可以考慮使用微軟的 LUIS 服務，在 LUIS 可以針對使用者所傳的資訊拆解 Entity / Intent，透過訊息的收集，透過自行定義的訓練語意讓 Chatbot 理解且更準的內容，但本系列文章應該不會介紹到這塊 (後續還是介紹一些好玩的 Line服務)\n懶人包，本次學到了什麼? QnA Maker 服務 https://azure.microsoft.com/zh-tw/services/cognitive-services/qna-maker/ Rule Base vs AI Base https://www.tricentis.com/artificial-intelligence-software-testing/ai-approaches-rule-based-testing-vs-learning/ 如何在 Line 串接 QnA Maker https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/quickstarts/quickstart-rest-curl ","wordCount":"323","inLanguage":"en","datePublished":"2020-11-16T08:17:05Z","dateModified":"2020-11-16T08:17:05Z","author":[{"@type":"Person","name":"Kyle"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://kyleap.github.io/it-ironman-line-chatbot-wedding-16/"},"publisher":{"@type":"Organization","name":"凱哥打扣 | Kyle Studio","logo":{"@type":"ImageObject","url":"https://kyleap.github.io/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kyleap.github.io/ accesskey=h title="凱哥打扣 (Alt + H)">凱哥打扣</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kyleap.github.io/kyleshen/ title=about><span>about</span></a></li><li><a href=https://kyleap.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://kyleap.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://kyleap.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li><li><a href=https://kyleap.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://kyleap.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://kyleap.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">來點AI感，用QnA Maker來搞Line Chatbot回覆 (16)</h1><div class=post-meta><span title='2020-11-16 08:17:05 +0000 UTC'>2020-11-16</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle</div></header><div class=post-content><p>第12 屆iT邦幫忙鐵人賽系列文章 (Day16)</p><h3 id=qna-maker-是啥>QnA Maker 是啥<a hidden class=anchor aria-hidden=true href=#qna-maker-是啥>#</a></h3><p>QnA Maker 是微軟提供一個雲端的自然語言處理 (NLP) 處理服務，可輕鬆透過網站後台建立自己的知識庫，並能從使用者所輸入的語句，理解他的意圖，提供可能對應的知識庫答案。QnA Maker提供了免費的方案，但限制就是只能有3份知識庫、每秒只能調用Api 3次，每月50,000筆Request，對於一般使用或技術評估來講很夠用了。要在 Line 串接大概分為以下步驟：</p><ul><li><input disabled type=checkbox> 在Azure註冊 QnA Maker</li><li><input disabled type=checkbox> 新增一個 knowledge base</li><li><input disabled type=checkbox> 增加題目與回答</li><li><input disabled type=checkbox> 完成訓練 & 發佈</li><li><input disabled type=checkbox> 取得 Endpoint、EndpointKey，來讓程式串接</li></ul><h3 id=建立-qna-maker>建立 QnA Maker<a hidden class=anchor aria-hidden=true href=#建立-qna-maker>#</a></h3><p>照著 <a href=https://www.qnamaker.ai/Create>https://www.qnamaker.ai/Create</a> Step By Step 步驟，因為QnA Maker是Azure的服務，故您可以需要Azure的訂閱，<a href="https://azure.microsoft.com/zh-tw/free/search/?&amp;ef_id=CjwKCAjw2Jb7BRBHEiwAXTR4jWTsX8lLSMwm-Mi3P695vreHWcQDY3-09Vng3hmEtK9961EgWdmMdhoCfCQQAvD_BwE:G:s&amp;OCID=AID2100121_SEM_CjwKCAjw2Jb7BRBHEiwAXTR4jWTsX8lLSMwm-Mi3P695vreHWcQDY3-09Vng3hmEtK9961EgWdmMdhoCfCQQAvD_BwE:G:s&amp;dclid=CjkKEQjw2Jb7BRCI65f7vu-NwMoBEiQA9pWPtVFz0pPTEIwuWMhc61wmanYzMTiIhMSX7d6vC9oGO9nw_wcB">由此註冊試用</a></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/1*-KVrqreTyyIZScyct0bRXA.png alt="Step 1 在 Azure 新增 QnA Maker 服務">
<em>Step 1 在 Azure 新增 QnA Maker 服務</em></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2074/1*qLZSJaqBbQRM_t1sYNMZOA.png alt="Step 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文">
<em>Step 2 選取剛剛建立的QnA Maker服務，並選擇繁體中文</em></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2134/1*XayTI-zE0s3nYlLdOVbUwg.png alt="Step 3 knowledge base 名稱">
<em>Step 3 knowledge base 名稱</em></p><p>步驟四可以匯入現有的資料集，來源可以是文件或者是線上的網站，這樣就不用重新建檔了，是不是很酷啊 :D</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2174/1*XNwNWTvX1RuZ7aDT8JLSsg.png alt="Step 4 匯入資料集 (本次先跳過)">
<em>Step 4 匯入資料集 (本次先跳過)</em></p><p>開始瘋狂建題目吧！我們來試試建立：&ldquo;新人怎麼認識的？&rdquo; 回答我們設定 &ldquo;我們是在打工餐廳認識的喔，那時的同事 put your hands up ??"，並點選Save And Train</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/3260/1*zOKE-7fA5n-k-OgVswxjzA.png alt></p><p>可以透過旁邊的模擬器測試，嘗試打類似的問話，都會對應的相同的回答</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/1*o-NMkpepwYGHwbL3Aqqm-g.png alt></p><h3 id=在-net-core-串接-qna-maker>在 .NET Core 串接 QnA Maker<a hidden class=anchor aria-hidden=true href=#在-net-core-串接-qna-maker>#</a></h3><p>在串接之前，記得要先點選 Publish</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/3102/1*dN2wo_-7PDNsq7dyeN768w.png alt></p><p>又是得到一個熟悉的 curl 指令，可以繼續用 <a href=https://curl.olsh.me/>https://curl.olsh.me/</a> 來轉 C# 啦</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2286/1*A7YvzfefGcIg15uzTF1KMw.png alt></p><p>QnAMakerUtility.cs</p><p>新增一個 Utility 來處理 QnA Maker，裡面的 Key 應該要移到appsetting.json比較好替換，最初幾篇有提到可以用 IOption 來注入，這邊就不再多提了。QnA Maker判斷出來會有個分數值，我們篩選最高的當作答案，另也定義一個選擇新參數為分數，如果有值的話，要大於這個分數我們才會回傳。</p><pre tabindex=0><code>    public class QnAMakerUtility

    {

    public async Task&lt;QnAMakterAnswer&gt; Get(string question, int? scope = null)

    {

    using (var httpClient = new HttpClient())

    {

    using (var request = new HttpRequestMessage(new HttpMethod(&#34;POST&#34;), &#34;https://qna-maker-lab.azurewebsites.net/qnamaker/knowledgebases/OOOOO-2d0e-4512-ba3f-a58fdc4c37e1/generateAnswer&#34;))

    {

    request.Headers.TryAddWithoutValidation(&#34;Authorization&#34;, &#34;EndpointKey 5fdcf6c7-eb76-4a53-9e3b-74570645bOOO&#34;);

    request.Content = new StringContent(&#34;{&#39;question&#39;:&#39;&#34; + question + &#34;&#39;}&#34;);

    request.Content.Headers.ContentType = MediaTypeHeaderValue.Parse(&#34;application/json&#34;);

    var response = await httpClient.SendAsync(request);

    var result = await response.Content.ReadAsStringAsync();

    var qnaResponse = JsonConvert.DeserializeObject&lt;QnAMakerResponse&gt;(result);

    // 取得分數最高的回答

    var answers = qnaResponse.answers;

    // 選擇性參數，大於多少分數才回傳，這樣看起來會比較準

    if(scope.HasValue)

    {

    answers = answers.Where(c =&gt; c.score &gt;= scope.Value);

    }

    var answer = answers.OrderByDescending(c =&gt; c.score).FirstOrDefault();

    // 無法辨識

    if (answer == null || answer.id == -1) return null;

    return answer;

    }

    }

    }

    }
</code></pre><p>QnAMakerResponse</p><pre tabindex=0><code>    public class QnAMakerResponse

    {

    public IEnumerable&lt;QnAMakterAnswer&gt; answers { get; set; }

    public bool activeLearningEnabled { get; set; }

    }

    public class QnAMakterAnswer

    {

    public object[] questions { get; set; }

    public string answer { get; set; }

    public float score { get; set; }

    public int id { get; set; }

    public object[] metadata { get; set; }

    }
</code></pre><p>調整一下 IntenFactory.cs</p><p>我們先判斷 Rule Base 的回覆 (字串完整比對)，有比對到就回傳了，如果沒有比對到，則丟到 AI Base (QnA Maker) 來判斷</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2526/1*ICyEYpjIDXjdRj1AkhPy5w.png alt></p><p>傳送 &ldquo;新人怎麼認識的？&rdquo; 分數是 100 分</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/1*CTDiQvLVcyat6aWmchmmVQ.png alt></p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/1*I6kIsqPzkhejTst--kl9ew.png alt></p><p>傳送 “當初怎麼交往的?” 分數是 26.53 分</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2718/1*B7gMWv8w5ybD-NBdfPCsOw.png alt></p><p>所以對話模型是要逐步訓練的，我們調整一下，提升交往關鍵字的分數，要記得重新訓練和發佈</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/3254/1*xB7_v2oeTXyjep777Hc0Zw.png alt></p><p>傳送 &ldquo;交往的過程&rdquo;，得到重新訓練後的分數 99 分了</p><p><img loading=lazy src=https://cdn-images-1.medium.com/max/2392/1*fPYySLQFzFt_F6SAhGLm7A.png alt></p><p>本篇就是 .NET Core 串接 QnA Maker 的過程，透過這種雲端語意辨識服務，我們再也不用在程式擴增一堆 Intent 實作，並且讓 Chatbot 聰明一點，使用者為什麼都可以知道它想問的意圖是什麼。如果要更聰明一點訓練，可以考慮使用微軟的 <a href=https://azure.microsoft.com/zh-tw/services/cognitive-services/language-understanding-intelligent-service/>LUIS</a> 服務，在 LUIS 可以針對使用者所傳的資訊拆解 Entity / Intent，透過訊息的收集，透過自行定義的訓練語意讓 Chatbot 理解且更準的內容，但本系列文章應該不會介紹到這塊 (後續還是介紹一些好玩的 Line服務)</p><h3 id=懶人包本次學到了什麼>懶人包，本次學到了什麼?<a hidden class=anchor aria-hidden=true href=#懶人包本次學到了什麼>#</a></h3><ul><li>QnA Maker 服務
<a href=https://azure.microsoft.com/zh-tw/services/cognitive-services/qna-maker/>https://azure.microsoft.com/zh-tw/services/cognitive-services/qna-maker/</a></li><li>Rule Base vs AI Base
<a href=https://www.tricentis.com/artificial-intelligence-software-testing/ai-approaches-rule-based-testing-vs-learning/>https://www.tricentis.com/artificial-intelligence-software-testing/ai-approaches-rule-based-testing-vs-learning/</a></li><li>如何在 Line 串接 QnA Maker
<a href=https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/quickstarts/quickstart-rest-curl>https://docs.microsoft.com/en-us/azure/cognitive-services/qnamaker/quickstarts/quickstart-rest-curl</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://kyleap.github.io/tags/chatbot/>Chatbot</a></li></ul><nav class=paginav><a class=prev href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-17/><span class=title>« Prev</span><br><span>Line Liff App v2 - 用 Vue.js 來實作 (17)</span>
</a><a class=next href=https://kyleap.github.io/it-ironman-line-chatbot-wedding-15/><span class=title>Next »</span><br><span>切換 Line 的圖文選單 (15)</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://kyleap.github.io/>凱哥打扣 | Kyle Studio</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>