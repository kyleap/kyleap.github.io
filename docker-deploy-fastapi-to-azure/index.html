<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>透過 docker 發行 FastAPI 到 Azure | Kyle Studio</title>
<meta name=keywords content="Docker,FastAPI,Python">
<meta name=description content="前言 除了 Azure 外，還有很多公有雲的服務可以做選擇，譬如AWS/GCP/heroku…等等，甚至可能不採用公有雲服務，自己架設伺服器也是有可能，基於以上這些不同環境，我會建議將服務都包成 docker，讓所開發的應用程式比較不會受到伺服器環境的影響，本篇就來介紹從一個基本的 FastAPI 包成 docker，並發佈的 Azure 服務上
docker 環境安裝 Docker 是一種軟體平台，可讓您快速地建立、測試和部署應用程式。Docker 將軟體封裝到名為容器的標準化單位，其中包含程式庫、系統工具、程式碼和執行時間等執行軟體所需的所有項目。使用 Docker，您可以將應用程式快速地部署到各種環境並加以擴展，而且知道程式碼可以執行 — from AWS 的介紹 https://aws.amazon.com/tw/docker/
 關於 docker 環境的安裝，網路上教學應該很多了，此篇文章就不再介紹，如果安裝成功，應該在命令列透過 docker — version 指令可以看到版本
 建立一個基本的 FastAPI 本篇再以一個最基本的 API 來做包成 docker 的介紹
requirements.txt fastAPI uvicorn  main.py from typing import Optional from fastapi import FastAPI app = FastAPI() @app.get(&#34;/&#34;) def read_root(): return {&#34;Hello&#34;: &#34;World&#34;} @app.get(&#34;/items/{item_id}&#34;) def read_item(item_id: int, q: Optional[str] = None): return {&#34;item_id&#34;: item_id, &#34;q&#34;: q}  執行以下指令 pip install -r requirement.">
<meta name=author content="Kyle">
<link rel=canonical href=https://kyleap.github.io/docker-deploy-fastapi-to-azure/>
<meta name=google-site-verification content="XYZabc">
<link crossorigin=anonymous href=/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kyleap.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://kyleap.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://kyleap.github.io/favicon-32x32.png>
<link rel=apple-touch-icon href=https://kyleap.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://kyleap.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DPE6YM5E5N"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-DPE6YM5E5N',{anonymize_ip:!1})}</script>
<meta property="og:title" content="透過 docker 發行 FastAPI 到 Azure">
<meta property="og:description" content="前言 除了 Azure 外，還有很多公有雲的服務可以做選擇，譬如AWS/GCP/heroku…等等，甚至可能不採用公有雲服務，自己架設伺服器也是有可能，基於以上這些不同環境，我會建議將服務都包成 docker，讓所開發的應用程式比較不會受到伺服器環境的影響，本篇就來介紹從一個基本的 FastAPI 包成 docker，並發佈的 Azure 服務上
docker 環境安裝 Docker 是一種軟體平台，可讓您快速地建立、測試和部署應用程式。Docker 將軟體封裝到名為容器的標準化單位，其中包含程式庫、系統工具、程式碼和執行時間等執行軟體所需的所有項目。使用 Docker，您可以將應用程式快速地部署到各種環境並加以擴展，而且知道程式碼可以執行 — from AWS 的介紹 https://aws.amazon.com/tw/docker/
 關於 docker 環境的安裝，網路上教學應該很多了，此篇文章就不再介紹，如果安裝成功，應該在命令列透過 docker — version 指令可以看到版本
 建立一個基本的 FastAPI 本篇再以一個最基本的 API 來做包成 docker 的介紹
requirements.txt fastAPI uvicorn  main.py from typing import Optional from fastapi import FastAPI app = FastAPI() @app.get(&#34;/&#34;) def read_root(): return {&#34;Hello&#34;: &#34;World&#34;} @app.get(&#34;/items/{item_id}&#34;) def read_item(item_id: int, q: Optional[str] = None): return {&#34;item_id&#34;: item_id, &#34;q&#34;: q}  執行以下指令 pip install -r requirement.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://kyleap.github.io/docker-deploy-fastapi-to-azure/"><meta property="og:image" content="https://user-images.githubusercontent.com/8849818/227669578-aace96bd-bfb3-4cd5-9e52-52d8742ed597.jpg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2023-01-15T15:21:01+00:00">
<meta property="article:modified_time" content="2023-01-15T15:21:01+00:00"><meta property="og:site_name" content="凱哥打扣 | Kyle Studio">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://user-images.githubusercontent.com/8849818/227669578-aace96bd-bfb3-4cd5-9e52-52d8742ed597.jpg">
<meta name=twitter:title content="透過 docker 發行 FastAPI 到 Azure">
<meta name=twitter:description content="前言 除了 Azure 外，還有很多公有雲的服務可以做選擇，譬如AWS/GCP/heroku…等等，甚至可能不採用公有雲服務，自己架設伺服器也是有可能，基於以上這些不同環境，我會建議將服務都包成 docker，讓所開發的應用程式比較不會受到伺服器環境的影響，本篇就來介紹從一個基本的 FastAPI 包成 docker，並發佈的 Azure 服務上
docker 環境安裝 Docker 是一種軟體平台，可讓您快速地建立、測試和部署應用程式。Docker 將軟體封裝到名為容器的標準化單位，其中包含程式庫、系統工具、程式碼和執行時間等執行軟體所需的所有項目。使用 Docker，您可以將應用程式快速地部署到各種環境並加以擴展，而且知道程式碼可以執行 — from AWS 的介紹 https://aws.amazon.com/tw/docker/
 關於 docker 環境的安裝，網路上教學應該很多了，此篇文章就不再介紹，如果安裝成功，應該在命令列透過 docker — version 指令可以看到版本
 建立一個基本的 FastAPI 本篇再以一個最基本的 API 來做包成 docker 的介紹
requirements.txt fastAPI uvicorn  main.py from typing import Optional from fastapi import FastAPI app = FastAPI() @app.get(&#34;/&#34;) def read_root(): return {&#34;Hello&#34;: &#34;World&#34;} @app.get(&#34;/items/{item_id}&#34;) def read_item(item_id: int, q: Optional[str] = None): return {&#34;item_id&#34;: item_id, &#34;q&#34;: q}  執行以下指令 pip install -r requirement.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kyleap.github.io/posts/"},{"@type":"ListItem","position":2,"name":"透過 docker 發行 FastAPI 到 Azure","item":"https://kyleap.github.io/docker-deploy-fastapi-to-azure/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"透過 docker 發行 FastAPI 到 Azure","name":"透過 docker 發行 FastAPI 到 Azure","description":"前言 除了 Azure 外，還有很多公有雲的服務可以做選擇，譬如AWS/GCP/heroku…等等，甚至可能不採用公有雲服務，自己架設伺服器也是有可能，基於以上這些不同環境，我會建議將服務都包成 docker，讓所開發的應用程式比較不會受到伺服器環境的影響，本篇就來介紹從一個基本的 FastAPI 包成 docker，並發佈的 Azure 服務上\ndocker 環境安裝 Docker 是一種軟體平台，可讓您快速地建立、測試和部署應用程式。Docker 將軟體封裝到名為容器的標準化單位，其中包含程式庫、系統工具、程式碼和執行時間等執行軟體所需的所有項目。使用 Docker，您可以將應用程式快速地部署到各種環境並加以擴展，而且知道程式碼可以執行 — from AWS 的介紹 https://aws.amazon.com/tw/docker/\n 關於 docker 環境的安裝，網路上教學應該很多了，此篇文章就不再介紹，如果安裝成功，應該在命令列透過 docker — version 指令可以看到版本\n 建立一個基本的 FastAPI 本篇再以一個最基本的 API 來做包成 docker 的介紹\nrequirements.txt fastAPI uvicorn  main.py from typing import Optional from fastapi import FastAPI app = FastAPI() @app.get(\u0026quot;/\u0026quot;) def read_root(): return {\u0026quot;Hello\u0026quot;: \u0026quot;World\u0026quot;} @app.get(\u0026quot;/items/{item_id}\u0026quot;) def read_item(item_id: int, q: Optional[str] = None): return {\u0026quot;item_id\u0026quot;: item_id, \u0026quot;q\u0026quot;: q}  執行以下指令 pip install -r requirement.","keywords":["Docker","FastAPI","Python"],"articleBody":"前言 除了 Azure 外，還有很多公有雲的服務可以做選擇，譬如AWS/GCP/heroku…等等，甚至可能不採用公有雲服務，自己架設伺服器也是有可能，基於以上這些不同環境，我會建議將服務都包成 docker，讓所開發的應用程式比較不會受到伺服器環境的影響，本篇就來介紹從一個基本的 FastAPI 包成 docker，並發佈的 Azure 服務上\ndocker 環境安裝 Docker 是一種軟體平台，可讓您快速地建立、測試和部署應用程式。Docker 將軟體封裝到名為容器的標準化單位，其中包含程式庫、系統工具、程式碼和執行時間等執行軟體所需的所有項目。使用 Docker，您可以將應用程式快速地部署到各種環境並加以擴展，而且知道程式碼可以執行 — from AWS 的介紹 https://aws.amazon.com/tw/docker/\n 關於 docker 環境的安裝，網路上教學應該很多了，此篇文章就不再介紹，如果安裝成功，應該在命令列透過 docker — version 指令可以看到版本\n 建立一個基本的 FastAPI 本篇再以一個最基本的 API 來做包成 docker 的介紹\nrequirements.txt fastAPI uvicorn  main.py from typing import Optional from fastapi import FastAPI app = FastAPI() @app.get(\"/\") def read_root(): return {\"Hello\": \"World\"} @app.get(\"/items/{item_id}\") def read_item(item_id: int, q: Optional[str] = None): return {\"item_id\": item_id, \"q\": q}  執行以下指令 pip install -r requirement.txt uvicorn main:app --reload  確認 localhost:8000 能在本機成功跑起站台\nDockerfile Dockerfile是一個設定檔，用來定義與管理當前這個資料夾所要封裝的應用程式，執行 docker 指令時，就會依造這個檔案所定義的步驟，將應用程式封裝到容器裡面\nDockerfile # 設定基底的 image，我們指定用python 3.9，執行時會從 dockerhub 這個平台將 python 的 image 拉下來 FROM python:3.9 # 設定容器的工作資料夾 WORKDIR /code # 複製本地資料夾 requirements.txt這個檔案至容器的 /code/requirements.txt COPY ./requirements.txt /code/requirements.txt # 於容器執行 pip 腳本 RUN pip install --no-cache-dir --upgrade -r /code/requirements.txt # 複製本地資料夾所有檔案(.代表當前目錄)至容器裡的資料夾 /code/app COPY . /code/app # 透過uvicorn執行FastAPI伺服器 CMD [\"uvicorn\", \"app.main:app\", \"--host\", \"0.0.0.0\", \"--port\", \"80\"]  包裝 docker image 將下來我們可以將我們的 FastAPI 程式，封裝成 image，名稱為 myfastapi\ndocker build -t myfastapi .  執行 docker images 應該會看到目前在本機已經有的 images\n執行 docker image 有了 image 後，下一步就是透過這個 image，把服務執行起來，這時我們可以用\ndocker run -d --name myapi -p 80:80 myfastapi    -d: 代表是在背景執行\n  — name: 這個服務的名稱\n  -p: 指令內外port :\n  myfastapi: image 名稱\n  執行後，應該會得到一個這個服務的唯一ID，我們可以用 **docker ps **來檢視目前執行中的服務\n瀏覽器到 localhost 確認能回傳 Hello World\n建立 docker image 的家 — Container Registry 進入 Azure Portal 搜尋 ACR 服務\n建立 ACR 服務，我們選 basic 方案即可\n發佈 docker image ACR 服務建立完了，下一步我們要將我們的 myfastapi 發佈到 ACR 上，在這步驟我會建議用 VS Code 是最方便的，如果要用指令的話，可以研究 Azure CLI 這個工具，來跟 ACR 做溝通\nVS Code 安裝 — Azure Account 安裝後執行 ctrl (cmd) + p 輸入 sign in 登入 azure 帳號\nVS Code 安裝 docker 確認 docker 的擴充功能，可以看到剛剛的包好的 image\n點選右鍵 push\n選擇剛剛建立的ACR服務後，就會看到命令列正在推送\n回到 azure portal 確認有成功推上\n將 image 發佈成 Azure Web App Service 建立 Azure Web App ，這次發行方式我們選擇 docker container\n選擇 ACR 服務與 Image 名稱\n進到 Azure Web App 服務\n確認瀏覽器能得到 Hello World\n持續交付 程式一定會一直改，也會包成新版本的 image，有沒有可能在有新的 image 時自動發行網站，在Azure可以這樣設定\n點選 Deployment Center 並勾選 Continuous deployment\n包成 image 我們再依序練習一次 main.py 改成 hello world 2\n執行 docker build -t myfastapi . — no-cache ，這次我們多加 — no-cache 指令避免它緩存住\n透過 VSCode 再 push 一次\n等待幾分鐘後，就能看到是新版的內容了\n小結 docker 可說是軟體工程師必備的知識了，一篇文章也無法完整教完整個docker的概念，建議可以用本文提到的關鍵字延伸去學習更多的知識，而本文章是以 Azure 文章為例，當應用程式容器化後，發佈或自建到其他平台也會方便不少，譬如 heroku 可以參考下面的文章，步驟其實大同小異，只是發到不同的 Container Registry / Cloud Platform\n站在 Docker 的肩膀上，部署任何語言的 Web 應用到 Heroku | by Larry Lu | Starbugs Weekly 星巴哥技術專欄 | Medium\n","wordCount":"346","inLanguage":"en","datePublished":"2023-01-15T15:21:01Z","dateModified":"2023-01-15T15:21:01Z","author":[{"@type":"Person","name":"Kyle"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://kyleap.github.io/docker-deploy-fastapi-to-azure/"},"publisher":{"@type":"Organization","name":"Kyle Studio","logo":{"@type":"ImageObject","url":"https://kyleap.github.io/favicon.ico"}}}</script>
</head>
<body class=dark id=top>
<script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://kyleap.github.io/ accesskey=h title="凱哥打扣 (Alt + H)">凱哥打扣</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://kyleap.github.io/kyleshen/ title=about>
<span>about</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/archives/ title=archives>
<span>archives</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/categories/ title=categories>
<span>categories</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/search/ title="search (Alt + /)" accesskey=/>
<span>search</span>
</a>
</li>
<li>
<a href=https://kyleap.github.io/tags/ title=tags>
<span>tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://kyleap.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://kyleap.github.io/posts/>Posts</a></div>
<h1 class=post-title>
透過 docker 發行 FastAPI 到 Azure
</h1>
<div class=post-meta><span title="2023-01-15 15:21:01 +0000 UTC">2023-01-15</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;Kyle
</div>
</header>
<div class=post-content><h1 id=前言>前言<a hidden class=anchor aria-hidden=true href=#前言>#</a></h1>
<p>除了 Azure 外，還有很多公有雲的服務可以做選擇，譬如AWS/GCP/heroku…等等，甚至可能不採用公有雲服務，自己架設伺服器也是有可能，基於以上這些不同環境，我會建議將服務都包成 docker，讓所開發的應用程式比較不會受到伺服器環境的影響，本篇就來介紹從一個基本的 FastAPI 包成 docker，並發佈的 Azure 服務上</p>
<h1 id=docker-環境安裝>docker 環境安裝<a hidden class=anchor aria-hidden=true href=#docker-環境安裝>#</a></h1>
<p>Docker 是一種軟體平台，可讓您快速地建立、測試和部署應用程式。Docker 將軟體封裝到名為容器的標準化單位，其中包含程式庫、系統工具、程式碼和執行時間等執行軟體所需的所有項目。使用 Docker，您可以將應用程式快速地部署到各種環境並加以擴展，而且知道程式碼可以執行 — from AWS 的介紹 <a href=https://aws.amazon.com/tw/docker/>https://aws.amazon.com/tw/docker/</a></p>
<blockquote>
<p>關於 docker 環境的安裝，網路上教學應該很多了，此篇文章就不再介紹，如果安裝成功，應該在命令列透過 <code>docker — version</code> 指令可以看到版本</p>
</blockquote>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*E9iADns3b4dmH-Lr alt>
</p>
<h1 id=建立一個基本的-fastapi>建立一個基本的 FastAPI<a hidden class=anchor aria-hidden=true href=#建立一個基本的-fastapi>#</a></h1>
<p>本篇再以一個最基本的 API 來做包成 docker 的介紹</p>
<h2 id=requirementstxt>requirements.txt<a hidden class=anchor aria-hidden=true href=#requirementstxt>#</a></h2>
<pre><code>fastAPI
uvicorn
</code></pre>
<h2 id=mainpy>main.py<a hidden class=anchor aria-hidden=true href=#mainpy>#</a></h2>
<pre><code>from typing import Optional

from fastapi import FastAPI

app = FastAPI()


@app.get(&quot;/&quot;)
def read_root():
    return {&quot;Hello&quot;: &quot;World&quot;}


@app.get(&quot;/items/{item_id}&quot;)
def read_item(item_id: int, q: Optional[str] = None):
    return {&quot;item_id&quot;: item_id, &quot;q&quot;: q}
</code></pre>
<h2 id=執行以下指令>執行以下指令<a hidden class=anchor aria-hidden=true href=#執行以下指令>#</a></h2>
<pre><code>pip install -r requirement.txt
uvicorn main:app --reload
</code></pre>
<p>確認 localhost:8000 能在本機成功跑起站台</p>
<h1 id=dockerfile>Dockerfile<a hidden class=anchor aria-hidden=true href=#dockerfile>#</a></h1>
<p>Dockerfile是一個設定檔，用來定義與管理當前這個資料夾所要封裝的應用程式，執行 docker 指令時，就會依造這個檔案所定義的步驟，將應用程式封裝到容器裡面</p>
<h2 id=dockerfile-1>Dockerfile<a hidden class=anchor aria-hidden=true href=#dockerfile-1>#</a></h2>
<pre><code># 設定基底的 image，我們指定用python 3.9，執行時會從 dockerhub 這個平台將 python 的 image 拉下來
FROM python:3.9

# 設定容器的工作資料夾
WORKDIR /code

# 複製本地資料夾 requirements.txt這個檔案至容器的 /code/requirements.txt
COPY ./requirements.txt /code/requirements.txt

# 於容器執行 pip 腳本
RUN pip install --no-cache-dir --upgrade -r /code/requirements.txt

# 複製本地資料夾所有檔案(.代表當前目錄)至容器裡的資料夾 /code/app
COPY . /code/app

# 透過uvicorn執行FastAPI伺服器
CMD [&quot;uvicorn&quot;, &quot;app.main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;80&quot;]
</code></pre>
<h1 id=包裝-docker-image>包裝 docker image<a hidden class=anchor aria-hidden=true href=#包裝-docker-image>#</a></h1>
<p>將下來我們可以將我們的 FastAPI 程式，封裝成 image，名稱為 <strong>myfastapi</strong></p>
<pre><code>docker build -t myfastapi .
</code></pre>
<p>執行 <strong>docker images</strong> 應該會看到目前在本機已經有的 images</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2728/0*ONt_xq2G7xybmfux alt>
</p>
<h1 id=執行-docker-image>執行 docker image<a hidden class=anchor aria-hidden=true href=#執行-docker-image>#</a></h1>
<p>有了 image 後，下一步就是透過這個 image，把服務執行起來，這時我們可以用</p>
<pre><code>docker run -d --name myapi -p 80:80 myfastapi
</code></pre>
<ul>
<li>
<p>-d: 代表是在背景執行</p>
</li>
<li>
<p>— name: 這個服務的名稱</p>
</li>
<li>
<p>-p: 指令內外port &lt;docker內部>:&lt;你的本機對應的port></p>
</li>
<li>
<p>myfastapi: image 名稱</p>
</li>
</ul>
<p>執行後，應該會得到一個這個服務的唯一ID，我們可以用 **docker ps **來檢視目前執行中的服務</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/3224/0*zazOG-yUZhNcb6Zn alt>
</p>
<p>瀏覽器到 localhost 確認能回傳 Hello World</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*lIvZJCTmlMKeegRR alt>
</p>
<h2 id=建立-docker-image-的家--container-registry>建立 docker image 的家 — Container Registry<a hidden class=anchor aria-hidden=true href=#建立-docker-image-的家--container-registry>#</a></h2>
<p>進入 Azure Portal 搜尋 ACR 服務</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*OZRJDwlz8kXS4nlM alt>
</p>
<p>建立 ACR 服務，我們選 basic 方案即可</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/3840/0*sxcs0MAqkhl4vNX_ alt>
</p>
<h2 id=發佈-docker-image>發佈 docker image<a hidden class=anchor aria-hidden=true href=#發佈-docker-image>#</a></h2>
<p>ACR 服務建立完了，下一步我們要將我們的 <strong>myfastapi</strong> 發佈到 ACR 上，在這步驟我會建議用 VS Code 是最方便的，如果要用指令的話，可以研究 Azure CLI 這個工具，來跟 ACR 做溝通</p>
<h2 id=vs-code-安裝--azure-account>VS Code 安裝 — Azure Account<a hidden class=anchor aria-hidden=true href=#vs-code-安裝--azure-account>#</a></h2>
<p>安裝後執行 ctrl (cmd) + p 輸入 sign in 登入 azure 帳號</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/3840/0*HuIZkXwBL4AtRTr2 alt>
</p>
<h2 id=vs-code-安裝-docker>VS Code 安裝 docker<a hidden class=anchor aria-hidden=true href=#vs-code-安裝-docker>#</a></h2>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/3840/0*wIOfhKWIuSw3s515 alt>
</p>
<p>確認 docker 的擴充功能，可以看到剛剛的包好的 image</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*o_XD1hnVmmY1oiri alt>
</p>
<p>點選右鍵 push</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/3840/0*Ab23cCgGJG_8CJzM alt>
</p>
<p>選擇剛剛建立的ACR服務後，就會看到命令列正在推送</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*kledWv0Tz_rwy9wd alt>
</p>
<p>回到 azure portal 確認有成功推上</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*KCuiA35YUwuYaPUU alt>
</p>
<h1 id=將-image-發佈成-azure-web-app-service>將 image 發佈成 Azure Web App Service<a hidden class=anchor aria-hidden=true href=#將-image-發佈成-azure-web-app-service>#</a></h1>
<p>建立 Azure Web App ，這次發行方式我們選擇 <strong>docker container</strong></p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*RCz3fenYWQi_oyVZ alt>
</p>
<p>選擇 ACR 服務與 Image 名稱</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*Qef-ZyyDK6tKZ_If alt>
</p>
<p>進到 Azure Web App 服務</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/3840/0*x6TpptIQY9_6NLoj alt>
</p>
<p>確認瀏覽器能得到 Hello World</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*oa_lynWnPo4gZnu1 alt>
</p>
<h1 id=持續交付>持續交付<a hidden class=anchor aria-hidden=true href=#持續交付>#</a></h1>
<p>程式一定會一直改，也會包成新版本的 image，有沒有可能在有新的 image 時自動發行網站，在Azure可以這樣設定</p>
<p>點選 Deployment Center 並勾選 Continuous deployment</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2148/0*XjecIF_lRtqFqbqK alt>
</p>
<p>包成 image 我們再依序練習一次
main.py 改成 hello world 2</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*VR68bJInuJnR1210 alt>
</p>
<p>執行 <strong>docker build -t myfastapi . — no-cache</strong> ，這次我們多加 — no-cache 指令避免它緩存住</p>
<p>透過 VSCode 再 push 一次</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*IVY3jSl9p6WkQfUI alt>
</p>
<p>等待幾分鐘後，就能看到是新版的內容了</p>
<p><img loading=lazy src=https://cdn-images-1.medium.com/max/2000/0*WnC_u-lXVAsrydND alt>
</p>
<h1 id=小結>小結<a hidden class=anchor aria-hidden=true href=#小結>#</a></h1>
<p>docker 可說是軟體工程師必備的知識了，一篇文章也無法完整教完整個docker的概念，建議可以用本文提到的關鍵字延伸去學習更多的知識，而本文章是以 Azure 文章為例，當應用程式容器化後，發佈或自建到其他平台也會方便不少，譬如 heroku 可以參考下面的文章，步驟其實大同小異，只是發到不同的 Container Registry / Cloud Platform</p>
<p><a href=https://medium.com/starbugs/deploy-any-web-application-to-heroku-with-docker-b64b9b0eb93>站在 Docker 的肩膀上，部署任何語言的 Web 應用到 Heroku | by Larry Lu | Starbugs Weekly 星巴哥技術專欄 | Medium</a></p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://kyleap.github.io/tags/docker/>Docker</a></li>
<li><a href=https://kyleap.github.io/tags/fastapi/>FastAPI</a></li>
<li><a href=https://kyleap.github.io/tags/python/>Python</a></li>
</ul>
<nav class=paginav>
<a class=prev href=https://kyleap.github.io/azure-board-pull-request-template/>
<span class=title>« Prev</span>
<br>
<span>在 Azure Repo 設定 Pull Request Template</span>
</a>
<a class=next href=https://kyleap.github.io/feature-flag-dotnet-core-basic-targeting/>
<span class=title>Next »</span>
<br>
<span>在 .NET Core 使用 Feature Flag (Feature Toggle) - 自訂邏輯</span>
</a>
</nav>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2023 <a href=https://kyleap.github.io/>Kyle Studio</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>